(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),10),document.addEventListener("keydown",o),E(e)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}e.d({},{Rx:()=>A,Ui:()=>p,RC:()=>E,gw:()=>I,bE:()=>T}),document.querySelector(".confirm-delete-button");var r=document.getElementsByName("new-place")[0],c=document.querySelector(".popup__input_type_card-name"),i=document.querySelector(".popup__input_type_url");function u(e,t,o,n,r,c,i,u,a){var s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__like-button"),d=s.querySelector(".card__delete-button");s.querySelector(".card__image").src=e.link,s.querySelector(".card__title").textContent=e.name,s.querySelector(".card__image").alt=e.name;var _=document.querySelector(".popup_type_confirm-delete"),f=s.querySelector(".card__like-counter");return f.textContent=r.length,c!==i?d.classList.add("card__delete-button-visible"):d.addEventListener("click",(function(){return a(s,u,_)})),r.forEach((function(e){e._id!==c&&0!==e.length||l.classList.add("card__like-button_is-active")})),l.addEventListener("click",(function(){return t(u,l,f)})),p.addEventListener("click",o),s}function a(e,t,o){t.classList.contains("card__like-button_is-active")?(t.classList.remove("card__like-button_is-active"),o.textContent--,I(e).then((function(e){return e.json()})).then((function(e){o.textContent=e.likes.length}))):(t.classList.add("card__like-button_is-active"),A(e).then((function(e){return e.json()})).then((function(e){o.textContent=e.likes.length})))}var p=document.querySelector(".places__list");Array.from(document.querySelectorAll(".popup__close")).forEach((function(e){e.addEventListener("click",(function(){return n(e.closest(".popup"))}))})),document.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_is-opened")&&n(e.target)})),r.addEventListener("submit",(function(e){e.preventDefault();var t=c.value,o=i.value,s=[];s.name=t,s.link=o;var l=[];j(t,o).then((function(e){return e.json()})).then((function(e){e={ownerId:e.owner._id,cardId:e._id},p.prepend(u(s,a,S,0,l,C,e.ownerId,e.cardId,_)),n(r.closest(".popup_is-opened")),r.reset()}))}));var s=document.querySelector(".popup__input_type_name"),l=document.querySelector(".popup__input_type_description"),d={},_=function(e,o,n){t(n),d.cardItem=e,d.id=o,d.popup=n};document.querySelector(".popup__form-confirm-delete").addEventListener("submit",(function(e){var t,o;e.preventDefault(),t=d.cardItem,o=d.id,t.remove(),T(o),n(d.popup)}));var f=document.getElementById("popup__form");f.addEventListener("submit",(function(e){e.preventDefault();var t=s.value,o=l.value,r=document.querySelector(".profile__title"),c=document.querySelector(".profile__description");r.textContent=t,c.textContent=o,n(f.closest(".popup_is-opened")),w(r.textContent,c.textContent)}));var m=document.querySelector(".profile__edit-button"),y=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_new-card");function S(e){if(e.target.classList.contains("card__image")){var o=document.querySelector(".popup_type_image"),n=e.target.closest(".places__item").querySelector(".card__image").src,r=e.target.closest(".places__item").querySelector(".card__title").textContent,c=o.querySelector(".popup__image"),i=o.querySelector(".popup__caption");c.src=n,i.textContent=r,t(o)}}m.addEventListener("click",(function(){t(y);var e=document.querySelector(".profile__title").textContent,o=document.querySelector(".profile__description").textContent,n=document.querySelector(".popup__input_type_name"),r=document.querySelector(".popup__input_type_description");n.value=e,r.value=o})),v.addEventListener("click",(function(){t(h)}));var b=document.querySelector(".profile__image"),q=document.querySelector(".popup_type_edit-avatar");function g(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",o.classList.remove("popup__input_error_visible"),t.classList.remove("popup__input_error")}(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));n.textContent=o,n.classList.add("popup__input_error_visible"),t.classList.add("popup__input_error")}(e,t,t.validationMessage),t.removeEventListener("input",(function(){g(e,t),L(inputList,buttonElement)}))}function L(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button_disabled"):t.classList.add("popup__button_disabled")}function E(e){Array.from(e.querySelectorAll(".popup__input-error-text")).forEach((function(e){e.textContent=""})),Array.from(e.querySelectorAll(".popup__input")).forEach((function(e){e.classList.remove("popup__input_error")}))}b.addEventListener("click",(function(){t(q)})),document.querySelector(".popup__form-edit-profile").addEventListener("submit",(function(e){e.preventDefault();var t=document.querySelector(".popup__avatar-input_type_url").value;b.style.backgroundImage="url(".concat(t,")"),n(q),P(t)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");L(t,o),t.forEach((function(n){n.addEventListener("input",(function(){g(e,n),L(t,o)}))}))}(e)}));var C=null,k=function(){fetch("https://nomoreparties.co/v1/wff-cohort-11/users/me",{headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")"),C=e._id})).catch((function(e){return console.log(e)}))},x=function(){fetch("https://nomoreparties.co/v1/wff-cohort-11/cards",{headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){p.append(u(e,a,S,0,e.likes,C,e.owner._id,e._id,_))}))})).catch((function(e){return console.log(e)}))};Promise.all([k,x]).then((function(){return k()}),x());var w=function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-11/users/me",{method:"PATCH",headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135","Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).catch((function(e){return console.log(e)}))},j=function(e,t){return fetch("https://nomoreparties.co/v1/wff-cohort-11/cards",{method:"POST",headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).catch((function(e){return console.log(e)}))},T=function(e){fetch("https://nomoreparties.co/v1/wff-cohort-11/cards/".concat(e),{method:"DELETE",headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135","Content-Type":"application/json"}}).catch((function(e){return console.log(e)}))},A=function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-11/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135","Content-Type":"application/json"}}).catch((function(e){return console.log(e)}))},I=function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-11/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135","Content-Type":"application/json"}}).catch((function(e){return console.log(e)}))},P=function(e){fetch("https://nomoreparties.co/v1/wff-cohort-11/users/me/avatar ",{method:"PATCH",headers:{authorization:"a05cfe34-771a-4bf5-8666-626b8e6ea135","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).catch((function(e){return console.log(e)}))}})();